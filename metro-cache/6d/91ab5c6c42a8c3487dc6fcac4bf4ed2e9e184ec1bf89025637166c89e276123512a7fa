{"dependencies":[{"name":"../BatchedBridge/BatchedBridge","data":{"isAsync":false,"locs":[{"start":{"line":13,"column":22},"end":{"line":13,"column":63}}]}},{"name":"../vendor/emitter/EventEmitter","data":{"isAsync":false,"locs":[{"start":{"line":14,"column":21},"end":{"line":14,"column":62}}]}},{"name":"./TaskQueue","data":{"isAsync":false,"locs":[{"start":{"line":15,"column":18},"end":{"line":15,"column":40}}]}},{"name":"../Utilities/infoLog","data":{"isAsync":false,"locs":[{"start":{"line":17,"column":16},"end":{"line":17,"column":47}}]}},{"name":"invariant","data":{"isAsync":false,"locs":[{"start":{"line":18,"column":18},"end":{"line":18,"column":38}}]}},{"name":"fbjs/lib/keyMirror","data":{"isAsync":false,"locs":[{"start":{"line":19,"column":18},"end":{"line":19,"column":47}}]}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var BatchedBridge = _$$_REQUIRE(_dependencyMap[0], \"../BatchedBridge/BatchedBridge\");\n\n  var EventEmitter = _$$_REQUIRE(_dependencyMap[1], \"../vendor/emitter/EventEmitter\");\n\n  var TaskQueue = _$$_REQUIRE(_dependencyMap[2], \"./TaskQueue\");\n\n  var infoLog = _$$_REQUIRE(_dependencyMap[3], \"../Utilities/infoLog\");\n\n  var invariant = _$$_REQUIRE(_dependencyMap[4], \"invariant\");\n\n  var keyMirror = _$$_REQUIRE(_dependencyMap[5], \"fbjs/lib/keyMirror\");\n\n  var _emitter = new EventEmitter();\n\n  var DEBUG_DELAY = 0;\n  var DEBUG = false;\n  var InteractionManager = {\n    Events: keyMirror({\n      interactionStart: true,\n      interactionComplete: true\n    }),\n    runAfterInteractions: function runAfterInteractions(task) {\n      var tasks = [];\n      var promise = new Promise(function (resolve) {\n        _scheduleUpdate();\n\n        if (task) {\n          tasks.push(task);\n        }\n\n        tasks.push({\n          run: resolve,\n          name: 'resolve ' + (task && task.name || '?')\n        });\n\n        _taskQueue.enqueueTasks(tasks);\n      });\n      return {\n        then: promise.then.bind(promise),\n        done: function done() {\n          if (promise.done) {\n            return promise.done.apply(promise, arguments);\n          } else {\n            console.warn('Tried to call done when not supported by current Promise implementation.');\n          }\n        },\n        cancel: function cancel() {\n          _taskQueue.cancelTasks(tasks);\n        }\n      };\n    },\n    createInteractionHandle: function createInteractionHandle() {\n      DEBUG && infoLog('InteractionManager: create interaction handle');\n\n      _scheduleUpdate();\n\n      var handle = ++_inc;\n\n      _addInteractionSet.add(handle);\n\n      return handle;\n    },\n    clearInteractionHandle: function clearInteractionHandle(handle) {\n      DEBUG && infoLog('InteractionManager: clear interaction handle');\n      invariant(!!handle, 'InteractionManager: Must provide a handle to clear.');\n\n      _scheduleUpdate();\n\n      _addInteractionSet.delete(handle);\n\n      _deleteInteractionSet.add(handle);\n    },\n    addListener: _emitter.addListener.bind(_emitter),\n    setDeadline: function setDeadline(deadline) {\n      _deadline = deadline;\n    }\n  };\n\n  var _interactionSet = new Set();\n\n  var _addInteractionSet = new Set();\n\n  var _deleteInteractionSet = new Set();\n\n  var _taskQueue = new TaskQueue({\n    onMoreTasks: _scheduleUpdate\n  });\n\n  var _nextUpdateHandle = 0;\n  var _inc = 0;\n\n  var _deadline = -1;\n\n  function _scheduleUpdate() {\n    if (!_nextUpdateHandle) {\n      if (_deadline > 0) {\n        _nextUpdateHandle = setTimeout(_processUpdate, 0 + DEBUG_DELAY);\n      } else {\n        _nextUpdateHandle = setImmediate(_processUpdate);\n      }\n    }\n  }\n\n  function _processUpdate() {\n    _nextUpdateHandle = 0;\n    var interactionCount = _interactionSet.size;\n\n    _addInteractionSet.forEach(function (handle) {\n      return _interactionSet.add(handle);\n    });\n\n    _deleteInteractionSet.forEach(function (handle) {\n      return _interactionSet.delete(handle);\n    });\n\n    var nextInteractionCount = _interactionSet.size;\n\n    if (interactionCount !== 0 && nextInteractionCount === 0) {\n      _emitter.emit(InteractionManager.Events.interactionComplete);\n    } else if (interactionCount === 0 && nextInteractionCount !== 0) {\n      _emitter.emit(InteractionManager.Events.interactionStart);\n    }\n\n    if (nextInteractionCount === 0) {\n      while (_taskQueue.hasTasksToProcess()) {\n        _taskQueue.processNext();\n\n        if (_deadline > 0 && BatchedBridge.getEventLoopRunningTime() >= _deadline) {\n          _scheduleUpdate();\n\n          break;\n        }\n      }\n    }\n\n    _addInteractionSet.clear();\n\n    _deleteInteractionSet.clear();\n  }\n\n  module.exports = InteractionManager;\n});","lineCount":145,"map":[[2,0,11,0],[4,0,13,0],[4,6,13,6,"BatchedBridge"],[4,19,13,19],[4,22,13,22,"require"],[4,33,13,29],[4,86,13,0],[6,0,14,0],[6,6,14,6,"EventEmitter"],[6,18,14,18],[6,21,14,21,"require"],[6,32,14,28],[6,85,14,0],[8,0,15,0],[8,6,15,6,"TaskQueue"],[8,15,15,15],[8,18,15,18,"require"],[8,29,15,25],[8,63,15,0],[10,0,17,0],[10,6,17,6,"infoLog"],[10,13,17,13],[10,16,17,16,"require"],[10,27,17,23],[10,70,17,0],[12,0,18,0],[12,6,18,6,"invariant"],[12,15,18,15],[12,18,18,18,"require"],[12,29,18,25],[12,61,18,0],[14,0,19,0],[14,6,19,6,"keyMirror"],[14,15,19,15],[14,18,19,18,"require"],[14,29,19,25],[14,70,19,0],[16,0,24,0],[16,6,24,6,"_emitter"],[16,14,24,14],[16,17,24,17],[16,21,24,21,"EventEmitter"],[16,33,24,17],[16,35,24,0],[18,0,26,0],[18,6,26,6,"DEBUG_DELAY"],[18,17,26,20],[18,20,26,23],[18,21,26,0],[19,0,27,0],[19,6,27,6,"DEBUG"],[19,11,27,18],[19,14,27,21],[19,19,27,0],[20,0,78,0],[20,6,78,6,"InteractionManager"],[20,24,78,24],[20,27,78,27],[21,0,79,2,"Events"],[21,4,79,2,"Events"],[21,10,79,8],[21,12,79,10,"keyMirror"],[21,21,79,19],[21,22,79,20],[22,0,80,4,"interactionStart"],[22,6,80,4,"interactionStart"],[22,22,80,20],[22,24,80,22],[22,28,79,20],[23,0,81,4,"interactionComplete"],[23,6,81,4,"interactionComplete"],[23,25,81,23],[23,27,81,25],[24,0,79,20],[24,5,79,19],[24,6,78,27],[25,0,88,2,"runAfterInteractions"],[25,4,88,2,"runAfterInteractions"],[25,24,78,27],[25,56,89,4,"task"],[25,60,78,27],[25,62,95,4],[26,0,96,4],[26,10,96,10,"tasks"],[26,15,96,15],[26,18,96,18],[26,20,96,4],[27,0,97,4],[27,10,97,10,"promise"],[27,17,97,17],[27,20,97,20],[27,24,97,24,"Promise"],[27,31,97,20],[27,32,97,32],[27,42,97,32,"resolve"],[27,49,97,39],[27,51,97,43],[28,0,98,6,"_scheduleUpdate"],[28,8,98,6,"_scheduleUpdate"],[28,23,98,21],[30,0,99,6],[30,12,99,10,"task"],[30,16,99,6],[30,18,99,16],[31,0,100,8,"tasks"],[31,10,100,8,"tasks"],[31,15,100,13],[31,16,100,14,"push"],[31,20,100,8],[31,21,100,19,"task"],[31,25,100,8],[32,0,101,7],[34,0,102,6,"tasks"],[34,8,102,6,"tasks"],[34,13,102,11],[34,14,102,12,"push"],[34,18,102,6],[34,19,102,17],[35,0,103,8,"run"],[35,10,103,8,"run"],[35,13,103,11],[35,15,103,13,"resolve"],[35,22,102,17],[36,0,104,8,"name"],[36,10,104,8,"name"],[36,14,104,12],[36,16,104,14],[36,30,104,29,"task"],[36,34,104,33],[36,38,104,37,"task"],[36,42,104,41],[36,43,104,42,"name"],[36,47,104,28],[36,51,104,51],[36,54,104,14],[37,0,102,17],[37,9,102,6],[39,0,106,6,"_taskQueue"],[39,8,106,6,"_taskQueue"],[39,18,106,16],[39,19,106,17,"enqueueTasks"],[39,31,106,6],[39,32,106,30,"tasks"],[39,37,106,6],[40,0,107,5],[40,7,97,20],[40,8,97,4],[41,0,108,4],[41,13,108,11],[42,0,109,6,"then"],[42,8,109,6,"then"],[42,12,109,10],[42,14,109,12,"promise"],[42,21,109,19],[42,22,109,20,"then"],[42,26,109,12],[42,27,109,25,"bind"],[42,31,109,12],[42,32,109,30,"promise"],[42,39,109,12],[42,40,108,11],[43,0,110,6,"done"],[43,8,110,6,"done"],[43,12,110,10],[43,14,110,12],[43,30,110,25],[44,0,111,8],[44,14,111,12,"promise"],[44,21,111,19],[44,22,111,20,"done"],[44,26,111,8],[44,28,111,26],[45,0,112,10],[45,19,112,17,"promise"],[45,26,112,24],[45,27,112,25,"done"],[45,31,112,17],[45,38,112,17,"promise"],[45,45,112,24],[45,57,112,10],[46,0,113,9],[46,11,111,8],[46,17,113,15],[47,0,114,10,"console"],[47,12,114,10,"console"],[47,19,114,17],[47,20,114,18,"warn"],[47,24,114,10],[47,25,115,12],[47,99,114,10],[48,0,117,9],[49,0,118,7],[49,9,108,11],[50,0,119,6,"cancel"],[50,8,119,6,"cancel"],[50,14,119,12],[50,16,119,14],[50,34,119,25],[51,0,120,8,"_taskQueue"],[51,10,120,8,"_taskQueue"],[51,20,120,18],[51,21,120,19,"cancelTasks"],[51,32,120,8],[51,33,120,31,"tasks"],[51,38,120,8],[52,0,121,7],[53,0,108,11],[53,7,108,4],[54,0,123,3],[54,5,78,27],[55,0,128,2,"createInteractionHandle"],[55,4,128,2,"createInteractionHandle"],[55,27,78,27],[55,64,128,36],[56,0,129,4,"DEBUG"],[56,6,129,4,"DEBUG"],[56,11,129,9],[56,15,129,13,"infoLog"],[56,22,129,20],[56,23,129,21],[56,70,129,20],[56,71,129,4],[58,0,130,4,"_scheduleUpdate"],[58,6,130,4,"_scheduleUpdate"],[58,21,130,19],[60,0,131,4],[60,10,131,10,"handle"],[60,16,131,16],[60,19,131,19],[60,21,131,21,"_inc"],[60,25,131,4],[62,0,132,4,"_addInteractionSet"],[62,6,132,4,"_addInteractionSet"],[62,24,132,22],[62,25,132,23,"add"],[62,28,132,4],[62,29,132,27,"handle"],[62,35,132,4],[64,0,133,4],[64,13,133,11,"handle"],[64,19,133,4],[65,0,134,3],[65,5,78,27],[66,0,139,2,"clearInteractionHandle"],[66,4,139,2,"clearInteractionHandle"],[66,26,78,27],[66,60,139,25,"handle"],[66,66,78,27],[66,68,139,41],[67,0,140,4,"DEBUG"],[67,6,140,4,"DEBUG"],[67,11,140,9],[67,15,140,13,"infoLog"],[67,22,140,20],[67,23,140,21],[67,69,140,20],[67,70,140,4],[68,0,141,4,"invariant"],[68,6,141,4,"invariant"],[68,15,141,13],[68,16,141,14],[68,17,141,15],[68,18,141,16,"handle"],[68,24,141,13],[68,26,141,24],[68,79,141,13],[68,80,141,4],[70,0,142,4,"_scheduleUpdate"],[70,6,142,4,"_scheduleUpdate"],[70,21,142,19],[72,0,143,4,"_addInteractionSet"],[72,6,143,4,"_addInteractionSet"],[72,24,143,22],[72,25,143,23,"delete"],[72,31,143,4],[72,32,143,30,"handle"],[72,38,143,4],[74,0,144,4,"_deleteInteractionSet"],[74,6,144,4,"_deleteInteractionSet"],[74,27,144,25],[74,28,144,26,"add"],[74,31,144,4],[74,32,144,30,"handle"],[74,38,144,4],[75,0,145,3],[75,5,78,27],[76,0,147,2,"addListener"],[76,4,147,2,"addListener"],[76,15,147,13],[76,17,147,16,"_emitter"],[76,25,147,24],[76,26,147,25,"addListener"],[76,37,147,16],[76,38,147,37,"bind"],[76,42,147,16],[76,43,147,42,"_emitter"],[76,51,147,16],[76,52,78,27],[77,0,154,2,"setDeadline"],[77,4,154,2,"setDeadline"],[77,15,78,27],[77,38,154,14,"deadline"],[77,46,78,27],[77,48,154,32],[78,0,155,4,"_deadline"],[78,6,155,4,"_deadline"],[78,15,155,13],[78,18,155,16,"deadline"],[78,26,155,4],[79,0,156,3],[80,0,78,27],[80,3,78,0],[82,0,159,0],[82,6,159,6,"_interactionSet"],[82,21,159,21],[82,24,159,24],[82,28,159,28,"Set"],[82,31,159,24],[82,33,159,0],[84,0,160,0],[84,6,160,6,"_addInteractionSet"],[84,24,160,24],[84,27,160,27],[84,31,160,31,"Set"],[84,34,160,27],[84,36,160,0],[86,0,161,0],[86,6,161,6,"_deleteInteractionSet"],[86,27,161,27],[86,30,161,30],[86,34,161,34,"Set"],[86,37,161,30],[86,39,161,0],[88,0,162,0],[88,6,162,6,"_taskQueue"],[88,16,162,16],[88,19,162,19],[88,23,162,23,"TaskQueue"],[88,32,162,19],[88,33,162,33],[89,0,162,34,"onMoreTasks"],[89,4,162,34,"onMoreTasks"],[89,15,162,45],[89,17,162,47,"_scheduleUpdate"],[90,0,162,33],[90,3,162,19],[90,4,162,0],[92,0,163,0],[92,6,163,4,"_nextUpdateHandle"],[92,23,163,21],[92,26,163,24],[92,27,163,0],[93,0,164,0],[93,6,164,4,"_inc"],[93,10,164,8],[93,13,164,11],[93,14,164,0],[95,0,165,0],[95,6,165,4,"_deadline"],[95,15,165,13],[95,18,165,16],[95,19,165,17],[95,20,165,0],[97,0,172,0],[97,11,172,9,"_scheduleUpdate"],[97,26,172,0],[97,29,172,27],[98,0,173,2],[98,8,173,6],[98,9,173,7,"_nextUpdateHandle"],[98,26,173,2],[98,28,173,26],[99,0,174,4],[99,10,174,8,"_deadline"],[99,19,174,17],[99,22,174,20],[99,23,174,4],[99,25,174,23],[100,0,178,6,"_nextUpdateHandle"],[100,8,178,6,"_nextUpdateHandle"],[100,25,178,23],[100,28,178,26,"setTimeout"],[100,38,178,36],[100,39,178,37,"_processUpdate"],[100,53,178,36],[100,55,178,53],[100,59,178,57,"DEBUG_DELAY"],[100,70,178,36],[100,71,178,6],[101,0,179,5],[101,7,174,4],[101,13,179,11],[102,0,180,6,"_nextUpdateHandle"],[102,8,180,6,"_nextUpdateHandle"],[102,25,180,23],[102,28,180,26,"setImmediate"],[102,40,180,38],[102,41,180,39,"_processUpdate"],[102,55,180,38],[102,56,180,6],[103,0,181,5],[104,0,182,3],[105,0,183,1],[107,0,188,0],[107,11,188,9,"_processUpdate"],[107,25,188,0],[107,28,188,26],[108,0,189,2,"_nextUpdateHandle"],[108,4,189,2,"_nextUpdateHandle"],[108,21,189,19],[108,24,189,22],[108,25,189,2],[109,0,191,2],[109,8,191,8,"interactionCount"],[109,24,191,24],[109,27,191,27,"_interactionSet"],[109,42,191,42],[109,43,191,43,"size"],[109,47,191,2],[111,0,192,2,"_addInteractionSet"],[111,4,192,2,"_addInteractionSet"],[111,22,192,20],[111,23,192,21,"forEach"],[111,30,192,2],[111,31,192,29],[111,41,192,29,"handle"],[111,47,192,35],[112,0,192,35],[112,13,192,39,"_interactionSet"],[112,28,192,54],[112,29,192,55,"add"],[112,32,192,39],[112,33,192,59,"handle"],[112,39,192,39],[112,40,192,35],[113,0,192,35],[113,5,192,2],[115,0,193,2,"_deleteInteractionSet"],[115,4,193,2,"_deleteInteractionSet"],[115,25,193,23],[115,26,193,24,"forEach"],[115,33,193,2],[115,34,193,32],[115,44,193,32,"handle"],[115,50,193,38],[116,0,193,38],[116,13,193,42,"_interactionSet"],[116,28,193,57],[116,29,193,58,"delete"],[116,35,193,42],[116,36,193,65,"handle"],[116,42,193,42],[116,43,193,38],[117,0,193,38],[117,5,193,2],[119,0,194,2],[119,8,194,8,"nextInteractionCount"],[119,28,194,28],[119,31,194,31,"_interactionSet"],[119,46,194,46],[119,47,194,47,"size"],[119,51,194,2],[121,0,196,2],[121,8,196,6,"interactionCount"],[121,24,196,22],[121,29,196,27],[121,30,196,6],[121,34,196,32,"nextInteractionCount"],[121,54,196,52],[121,59,196,57],[121,60,196,2],[121,62,196,60],[122,0,198,4,"_emitter"],[122,6,198,4,"_emitter"],[122,14,198,12],[122,15,198,13,"emit"],[122,19,198,4],[122,20,198,18,"InteractionManager"],[122,38,198,36],[122,39,198,37,"Events"],[122,45,198,18],[122,46,198,44,"interactionComplete"],[122,65,198,4],[123,0,199,3],[123,5,196,2],[123,11,199,9],[123,15,199,13,"interactionCount"],[123,31,199,29],[123,36,199,34],[123,37,199,13],[123,41,199,39,"nextInteractionCount"],[123,61,199,59],[123,66,199,64],[123,67,199,9],[123,69,199,67],[124,0,201,4,"_emitter"],[124,6,201,4,"_emitter"],[124,14,201,12],[124,15,201,13,"emit"],[124,19,201,4],[124,20,201,18,"InteractionManager"],[124,38,201,36],[124,39,201,37,"Events"],[124,45,201,18],[124,46,201,44,"interactionStart"],[124,62,201,4],[125,0,202,3],[127,0,205,2],[127,8,205,6,"nextInteractionCount"],[127,28,205,26],[127,33,205,31],[127,34,205,2],[127,36,205,34],[128,0,206,4],[128,13,206,11,"_taskQueue"],[128,23,206,21],[128,24,206,22,"hasTasksToProcess"],[128,41,206,11],[128,43,206,4],[128,45,206,43],[129,0,207,6,"_taskQueue"],[129,8,207,6,"_taskQueue"],[129,18,207,16],[129,19,207,17,"processNext"],[129,30,207,6],[131,0,208,6],[131,12,209,8,"_deadline"],[131,21,209,17],[131,24,209,20],[131,25,209,8],[131,29,210,8,"BatchedBridge"],[131,42,210,21],[131,43,210,22,"getEventLoopRunningTime"],[131,66,210,8],[131,72,210,51,"_deadline"],[131,81,208,6],[131,83,211,8],[132,0,213,8,"_scheduleUpdate"],[132,10,213,8,"_scheduleUpdate"],[132,25,213,23],[134,0,214,8],[135,0,215,7],[136,0,216,5],[137,0,217,3],[139,0,218,2,"_addInteractionSet"],[139,4,218,2,"_addInteractionSet"],[139,22,218,20],[139,23,218,21,"clear"],[139,28,218,2],[141,0,219,2,"_deleteInteractionSet"],[141,4,219,2,"_deleteInteractionSet"],[141,25,219,23],[141,26,219,24,"clear"],[141,31,219,2],[142,0,220,1],[144,0,222,0,"module"],[144,2,222,0,"module"],[144,8,222,6],[144,9,222,7,"exports"],[144,16,222,0],[144,19,222,17,"InteractionManager"],[144,37,222,0]],"functionMap":{"names":["<global>","runAfterInteractions","Promise$argument_0","done","cancel","createInteractionHandle","clearInteractionHandle","setDeadline","_scheduleUpdate","_processUpdate","_addInteractionSet.forEach$argument_0","_deleteInteractionSet.forEach$argument_0"],"mappings":"AAA;ECuF;gCCS;KDU;YEG;OFQ;cGC;OHE;GDE;EKK;GLM;EMK;GNM;EOS;GPE;AQgB;CRW;ASK;6BCI,qCD;gCEC,wCF;CT2B"}},"type":"js/module"}]}